---
title: "Power Platform + Microsoft Azure で SharePoint のサイト作成フォームを作ってみる"
emoji: "💻"
type: "tech"
topics: ["azure", "powerapps", "powerautomate", "sharepoint"]
published: true
---

:::message
この記事ははてなブログに 2020/2/3 に投稿したものの転載です。
:::

# はじめに

2020/1/31 に行われた **Power Apps でローコーディングな勉強会 #12** に参加してきました。

https://powerapps.connpass.com/event/162135/

その際にちょっとしたアプリを作成したのでここで紹介したいと思います。

# 実行方法

アプリの概要としては **Power Apps から SharePoint のサイト コレクションを作成する** というものです。SharePoint のサイト コレクションは GUI で作成する以外では PowerShell または CSOM (C#) による作成が可能になっています。今回は、Azure Automation で PowerShell を実行することによって、サイト コレクションの作成を実現しました。

## Azure Automation

まずは事前準備として Azure Automation で SharePoint Online Management Shell を使うためにモジュールをインストールする必要があります。モジュールはギャラリーから検索してインストールすることができます。

![](/images/2020_02_03_120000_001.png)

次に `Runbook` を作成します。事前に用意しておいた資格情報で接続し `New-SPOSite` を実行するだけの簡単なものです。

![](/images/2020_02_03_120000_002.png)

## Power Apps

Azure Automation に渡す情報を入力するためのフォームを作成します。あまり時間がなかったのでバリデーションなんかのチェックは入っていません。こういう場合のバリデーションはどうやってやるんですかね？まだまだ Power Apps スキル不足を感じます。

![](/images/2020_02_03_120000_003.png)

## Power Automate

Power Apps で入力後、ボタンをクリックしたときに動作する Power Automate を定義します。ここでは単純に Power Apps から受け取ったパラメーターを Azure Automation に受け渡しています。

![](/images/2020_02_03_120000_004.png)

# 実行結果

実行してみるとサイト コレクションが作成できていることがわかります。

![](/images/2020_02_03_120000_005.png)

# おわりに

今回は単純に Power Automate は Azure Automation を呼ぶだけでしたが、承認フローを入れたり、作成後にメールや Microsoft Teams に通知する機能を付けたりと、もっといろいろなことができると思います。また、Power Automate から Azure Automation を呼び出すというテクニックは、ほかの場面でも応用が効くと思いますので、ぜひとも使っていただきたいと思います。
