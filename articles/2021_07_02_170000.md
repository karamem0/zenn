---
title: "PnP PowerShell ã‚’ä»»æ„ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã§å®Ÿè¡Œã™ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["powershell", "sharepoint"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2021/7/2 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

PnP PowerShell ã‚’æœ€åˆã«å®Ÿè¡Œã—ãŸã¨ãã« Admin Consent ã‚’è¦æ±‚ã•ã‚Œã‚‹ã®ã§ã™ãŒã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®ä¸€è¦§ãŒã‚¨ã‚°ãã¦ã³ã£ãã‚Šã—ã¾ã™ã€‚

![](/images/2021_07_02_170000_001.png)

![](/images/2021_07_02_170000_002.png)

ã•ã™ãŒã«ã“ã‚Œã¯è¨±å¯ã—ã¥ã‚‰ã„ã®ã§ã€ã‚‚ã†ã¡ã‚‡ã£ã¨ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’åˆ¶é™ã—ãŸä¸Šã§ PnP PowerShell ã‚’ä½¿ã„ãŸã„ã§ã™ã€‚æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚

# SharePoint ã‚¢ãƒ‰ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹

ã‚¢ãƒ‰ã‚¤ãƒ³ã®ç™»éŒ²æ–¹æ³•ã‚’ã¯ã˜ã‚è©³ã—ã„æ‰‹é †ã¯ã“ã¡ã‚‰ãŒè©³ã—ã„ã§ã™ã€‚

https://jpspsupport.github.io/blog/sharepoint-online/pnp-powershell-with-app-only-token

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ID ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚

```powershell
Connect-PnPOnline -Url https://{{tenant-name}}.sharepoint.com -ClientId {{client-id}} -ClientId {{client-secret}}
```

æ³¨æ„ã™ã‚‹ã¹ãç‚¹ã¨ã—ã¦ã€æ—¢å®šã§ã¯ä½¿ãˆãªã„ãƒ†ãƒŠãƒ³ãƒˆãŒã‚ã‚‹ãã†ã§ã™ã€‚

> 2020 å¹´å¤é ƒä»¥é™ã«æ–°è¦ä½œæˆã—ãŸãƒ†ãƒŠãƒ³ãƒˆã«ãŠã„ã¦ã€ã‚¢ãƒ—ãƒªå°‚ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ—¢å®šã§ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

# Azure AD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹

## å§”ä»»ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹è¨±å¯

å§”ä»»ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ (ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³) ã®å ´åˆã€ä»¥ä¸‹ã®æ–¹æ³•ãŒå¯èƒ½ã§ã™ã€‚

```powershell
Connect-PnPOnline -Url https://{{tenant-name}}.sharepoint.com -Tenant {{tenant-id}} -ClientId {{client-id}} -DeviceLogin
```

Tenant ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å ´åˆã¯ä¸è¦ã§ã™ã€‚

æ³¨æ„ã™ã‚‹ã¹ãç‚¹ã¨ã—ã¦ã€Azure AD ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ‘ãƒ–ãƒªãƒƒã‚¯ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ãƒ•ãƒ­ãƒ¼ã‚’è¨±å¯ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è¨±å¯ã—ã¦ã„ãªã„å ´åˆã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚

> AADSTS7000218: The request body must contain the following parameter: 'client_assertion' or 'client_secret'.

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®å ´åˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã†ã“ã¨ã¯ã§ããšã€è¨¼æ˜æ›¸ã«ã‚ˆã‚‹ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…é ˆã«ãªã‚Šã¾ã™ã€‚

```powershell
Connect-PnPOnline -Url https://{{tenant-name}}.sharepoint.com -Tenant {{tenant-id}} -ClientId {{client-id}} -CertificatePath {{certificate-path}} -CertificatePassword {{certificate-password}}
```

## ã‚¢ã‚¯ã‚»ã‚¹ ãƒˆãƒ¼ã‚¯ãƒ³

å–å¾—æ¸ˆã¿ã®ã‚¢ã‚¯ã‚»ã‚¹ ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```powershell
Connect-PnPOnline -Url https://{{tenan-tname}}.sharepoint.com -Tenant {{tenant-id}} -AccessToken {{access-token}}
```

# ãŠã‚ã‚Šã«

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã™ã¹ã¦æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã™ãŒã¡ã‚‡ã„ã¡ã‚‡ã„ä¸è¦ªåˆ‡ãªã‚“ã§ã™ã‚ˆã­ã€‚

https://github.com/pnp/powershell/blob/dev/documentation/Connect-PnPOnline

ãã‚‚ãã‚‚ Scope ã‚’æŒ‡å®šã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã»ã—ã„ã¨æ€ã£ãŸã‚‰ã€`Register-PnPAzureADApp` ã‚’ä½¿ã£ã¦å¿…è¦ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æŒã¤ã‚¢ãƒ—ãƒªã‚’ç°¡å˜ã«ä½œã£ã¦ã­ã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã§ã™ã€‚ç†å±ˆã¯ã‚ã‹ã‚‹ã‘ã©ã„ã¾ã„ã¡ãªæ°—ãŒã—ã¾ã™ã­ã€‚

https://github.com/pnp/powershell/issues/421
