---
title: "XmlSerializer ã¨ DefaultValueAttribute ã¯ä¸€ç·’ã«ä½¿ã†ã¨ã‚ˆããªã„ã“ã¨ãŒèµ·ãã‚‹ã‚‰ã—ã„"
emoji: "ğŸ’»"
type: "tech"
topics: ["csharp"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2012/4/1 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

ã„ã¾ã•ã‚‰ãªã®ã§ã™ãŒ `DefaultValueAttribute` å±æ€§ãŒä»˜ã‘ã‚‰ã‚ŒãŸãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ `XmlSerializer` ã§ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã¨ã€XML ã«å€¤ãŒæ›¸ãè¾¼ã¾ã‚Œãªã„ã‚‰ã—ã„ã§ã™ã€‚ã—ã‹ã‚‚ã€ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹ã¨ãã‚‚ä½•ã‚‚ã—ã¦ãã‚Œãªã„ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¦ã—ã¾ã„ã¾ã™ã€‚å†ç¾ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã¿ã¾ã™ã€‚

```csharp
public class Program
{

    // DefaultValue ã‚’ä»˜ã‘ãŸãƒ¡ãƒ³ãƒãƒ¼ã‚’æŒã¤ã‚¯ãƒ©ã‚¹
    public class Hoge
    {

        [DefaultValue(100)]
        public int Piyo { get; set; }

    }

    private static void Main()
    {
        var hoge = new Hoge();
        var serializer = new XmlSerializer(typeof(Hoge));
        // DefaultValue ã¨åŒã˜å€¤ã‚’ä»•è¾¼ã‚“ã§ã¿ã‚‹
        hoge.Piyo = 100;
        using (var stream = File.Open("hoge.xml", FileMode.Create, FileAccess.ReadWrite))
        {
            // ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹
            serializer.Serialize(stream, hoge);
            // æœ€åˆã«æˆ»ã£ã¦
            stream.Position = 0;
            // ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹
            hoge = (Hoge)serializer.Deserialize(stream);
        }
        // çµæœã‚’å‡ºåŠ›ã™ã‚‹
        Console.WriteLine("piyo: " + hoge.Piyo);
        Console.ReadLine();
    }

}
```

ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã¨çµæœã¯ã“ã†ãªã‚Šã¾ã™ã€‚

```cmd
    piyo: 0
```

å‡ºåŠ›ã•ã‚Œã‚‹ XML ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚è¦‹ã‚„ã™ã•ã®ãŸã‚ã«æ”¹è¡Œã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚ç¢ºã‹ã«å€¤ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

```xml
<?xml version="1.0"?>
<Hoge xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema" />
```

ã©ã†ã‚‚ã“ã®å‹•ä½œã¯ä»•æ§˜ã‚‰ã—ã„ã¨ã®ã“ã¨ã€‚

ã¨ã¯ã„ãˆã€ãã‚Œã§ã¯ã‚ã¾ã‚Šã«ã²ã©ã„ã®ã§ã¡ã‚‡ã“ã£ã¨æ‰‹ã‚’å…¥ã‚Œã¦ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã™ã‚‹å¯¾è±¡ã®ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãåŠ ãˆã¦ã¿ã¾ã™ã€‚è‡ªå‰ã§ `DefaultValueAttribute` ã®å€¤ã§åˆæœŸåŒ–ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

```csharp
public Hoge()
{
    Array.ForEach(this.GetType().GetProperties(), x =>
    {
        var attr = Attribute.GetCustomAttribute(x, typeof(DefaultValueAttribute));
        if (attr != null)
        {
            x.SetValue(this, ((DefaultValueAttribute)attr).Value, null);
        }
    });
}
```

ã“ã‚Œã§å®Ÿè¡Œã™ã‚‹ã¨ã€çµæœã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```batch
    piyo: 100
```

ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ä½¿ã†ã®ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒå¤šå°‘æ°—ã«ãªã‚‹ã®ã¨ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºé–¢ä¿‚ãªã `DefaultValueAttribute` ã®å€¤ã§åˆæœŸåŒ–ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšå›°ã£ãŸã“ã¨ã¯ãªã„ã®ã§å¤§ä¸ˆå¤«ã‹ã¨æ€ã„ã¾ã™ã€‚
