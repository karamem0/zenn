---
title: "Microsoft Graph ã§ä¼šè­°å®¤ã®äºˆå®šè¡¨ã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["azuread", "csharp", "microsoftgraph"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2018/7/2 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

å…ƒãƒã‚¿ã¯ã“ã¡ã‚‰ã€‚

https://social.msdn.microsoft.com/Forums/ja-JP/2c124c80-585b-426f-94ed-68131049e954?WT.mc_id=M365-MVP-5002941

çµæ§‹ã‚ˆãã‚ã‚‹è©±ã§ OAuth ã®ãƒãƒã‚Šã©ã“ã‚ã®æœ€ãŸã‚‹ã‚‚ã®ãŒã€Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ä¸ãˆãŸã®ã«ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Œãªã„ã€ã¨ãªã‚‹ã“ã¨ãªã®ã§ã™ã€‚
ä¸Šè¨˜ã®ã€Œ`Calendars.ReadWrite.Shared` ã‚’ä»˜ã‘ãŸã®ã«ä¼šè­°å®¤ã®æƒ…å ±ãŒå–ã‚Œãªã„ã€ã¨ã„ã†ã®ã¯ã€ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ¨©é™ãŒãªã„ã‹ã‚‰ã§ã€ã“ã‚Œã¯ã‚€ã—ã‚æ­£ã—ã„å‹•ä½œãªè¨³ã§ã™ã€‚**å§”ä»»ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹è¨±å¯** ã¨ã„ã†åå‰ãŒè¡¨ã™é€šã‚Šã§ã™ã­ã€‚
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚èª¬æ˜ãŒã‚ã‚Šã¾ã™ã€‚

https://developer.microsoft.com/ja-jp/graph/docs/concepts/permissions_reference?WT.mc_id=M365-MVP-5002941

> å§”ä»»ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®å ´åˆã€ã‚¢ãƒ—ãƒªã®æœ‰åŠ¹ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã¯ã€ã‚¢ãƒ—ãƒªã«ä»˜ä¸ã•ã‚Œã¦ã„ã‚‹å§”ä»»ã•ã‚ŒãŸã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ (åŒæ„ã«ã‚ˆã£ã¦ä»˜ä¸) ã¨ç¾åœ¨ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹æ¨©ãŒé‡ãªã‚‹ç¯„å›²ã«åã¾ã‚‹æœ€å°æ¨©é™ã«ãªã‚Šã¾ã™ã€‚

ã˜ã‚ƒã‚ã©ã†ã™ã‚‹ã®ã¨ã„ã†ã¨ã€ä»£ã‚ã‚Šã« **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯** ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ãŸã ã—ã€ã“ã¡ã‚‰ã¯ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ä½œã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æƒ³å®šã—ã¦ã„ã‚‹ã®ã§ã€æ°—ã‚’ä»˜ã‘ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã« `Calendars.Read` ã‚’ä»˜ã‘ã‚‹ã¨ã€ç‰¹å®šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã ã‘ã§ã¯ãªãã€ã™ã¹ã¦ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®äºˆå®šè¡¨ãŒè¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯ãŒé«˜ããªã‚‹ã®ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å‹•ä½œã™ã‚‹ã‚¢ãƒ—ãƒªã§ã®ä½¿ç”¨ã¯ç‰¹ã«æ°—ã‚’ä»˜ã‘ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚

å‰ç½®ããŒé•·ããªã£ãŸã®ã§ã‚µãƒ³ãƒ—ãƒ« ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä»Šå›ã¯ MSAL ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

```csharp
using Microsoft.Identity.Client;
using System;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Threading.Tasks;

namespace ConsoleApplication1
{

    public static class Program
    {

        private static readonly string TenantId = "{{tenant-id}}";
        private static readonly string RedirectUrl = "{{redirect-url}}";
        private static readonly string ClientId = "{{client-id}}";
        private static readonly string ClientSecret = "{{client-secret}}";

        private static readonly string Authority = $"https://login.microsoftonline.com/{TenantId}/v2.0";
        private static readonly string ResourceId = "https://graph.microsoft.com/.default";
        private static readonly string RequestUrl = "https://graph.microsoft.com/v1.0/users/{0}/calendarView?StartDateTime={1:s}&EndDateTime={2:s}";

        private static void Main(string[] args)
        {
            var userId = "{{resource-id}}";
            var startDateTime = DateTime.Today;
            var endDateTime = DateTime.Today.AddDays(1);
            GetCalendarAsync(userId, startDateTime, endDateTime).GetAwaiter().GetResult();
        }

        private static async Task GetCalendarAsync(string userId, DateTime startDateTime, DateTime endDateTime)
        {
            var oauthClient = new ConfidentialClientApplication(ClientId, Authority, RedirectUrl, new ClientCredential(ClientSecret), null, new TokenCache());
            var oauthResult = await oauthClient.AcquireTokenForClientAsync(new[] { ResourceId });
            var httpClient = new HttpClient();
            httpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", oauthResult.AccessToken);
            httpClient.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
            var responseMessage = await httpClient.GetAsync(string.Format(RequestUrl, userId, startDateTime, endDateTime));
            var responseContent = await responseMessage.Content.ReadAsStringAsync();
        }

    }

}
```

ã¡ãªã¿ã«ã€`findMeetingTimes` ã¯ **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯** ã§ã¯å‹•ä½œã—ãªã„ã®ã§ã€ã“ã£ã¡ã‚’ä½¿ã„ãŸã„å ´åˆã¯ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ä»˜ã‘ã‚‹ã—ã‹ãªã„ã§ã™ã­ã€‚
