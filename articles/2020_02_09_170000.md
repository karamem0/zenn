---
title: "SharePoint Framework ã‚’ä½¿ã£ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã£ã¦ã¿ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["microsoftgraph", "sharepoint"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2020/2/9 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

ã‹ãªã‚Šä»¥å‰ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ãŒã€SharePoint ã® Web ãƒ‘ãƒ¼ãƒ„ã‚’ä½¿ã£ã¦ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚

https://zenn.dev/karamem0/articles/2011_09_14_000000

ä»Šå›ã¯ã“ã®è¨˜äº‹ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆç‰ˆã¨ãªã‚Šã¾ã™ã€‚ç¾åœ¨ã® SharePoint é–‹ç™ºã®ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã§ã‚ã‚‹ SharePoint Framework ã‚’ä½¿ã£ã¦ Web ãƒ‘ãƒ¼ãƒ„ã‚’ä½œæˆã—ã€Microsoft Graph ã§ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹ã¨ã„ã†ã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚

# ã‚µãƒ³ãƒ—ãƒ« ã‚³ãƒ¼ãƒ‰

https://github.com/karamem0/samples/tree/main/sharepoint-framework-mail-form

ä»Šå›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã—ã¦ React ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚React ã‚’ä½¿ç”¨ã—ãŸå ´åˆã€Office UI Fablic ãŠã‚ˆã³ PnP SPFx Controls ãŒä½¿ãˆã¾ã™ã®ã§ã€é–‹ç™ºç”Ÿç”£æ€§ãŒæ ¼æ®µã«ä¸ŠãŒã‚Šã¾ã™ã€‚

## MyApplicationWebPart.ts

React ã‚’ä½¿ã£ãŸ SharePoint Framework é–‹ç™ºã®å®šç•ªã¨ã—ã¦ã€Component ã® `props` ã« `context` ã‚’æ¸¡ã™ã¨ã„ã†ã®ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’ã‚„ã£ã¦ãŠã‹ãªã„ã¨ã€Component å´ã§ Microsoft Graph ã®å‘¼ã³å‡ºã—ãªã©ã€ã„ã‚ã„ã‚ãªã“ã¨ãŒã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸã¨ãã«ã¯ã“ã®ãƒ­ã‚¸ãƒƒã‚¯ã¯å…¥ã£ã¦ã„ã¾ã›ã‚“ã®ã§ã€ã¯ã˜ã‚ã«ã‚„ã£ã¦ãŠãã‚ˆã†ã«ã—ã¾ã™ã€‚

```typescript
export default class MyApplicationWebPart extends BaseClientSideWebPart<IMyApplicationWebPartProps> {

  public render(): void {
    const element: React.ReactElement<IMailFormProps> = React.createElement(
      MailForm,
      {
        context: this.context,
      }
    );

    ReactDom.render(element, this.domElement);
  }

}
```

## MailForm.tsx

PnP SPFx Controls ã«ã¯ `PeoplePicker` ã¨ã„ã†ä¾¿åˆ©ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§å®›å…ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¯ã“ã‚Œã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ãã‚Œä»¥å¤–ã¯ Office UI Fabric ã® `TextField` ã‚’ä½¿ã„ã¾ã—ãŸã€‚å…¥åŠ›ã•ã‚ŒãŸå€¤ã¯ `state` ã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚é€ä¿¡ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã«ã€`state` ã®å€¤ã‚’ä½¿ã£ã¦ Microsoft Graph ã® `sendMail` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ãƒ¡ãƒ¼ãƒ«ã‚’é€ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```typescript
import * as React from 'react';
import { MSGraphClient } from '@microsoft/sp-http';
import { IMailFormProps } from './IMailFormProps';
import { IMailFormState } from './IMailFormState';
import styles from './MailForm.module.scss';
import * as strings from 'MyApplicationWebPartStrings';
import { PeoplePicker, PrincipalType } from '@pnp/spfx-controls-react/lib/PeoplePicker';
import { TextField } from 'office-ui-fabric-react/lib/TextField';
import { PrimaryButton } from 'office-ui-fabric-react/lib/Button';

export default class MyApplication extends React.Component<IMailFormProps, IMailFormState> {

  constructor(props) {
    super(props);
    this.state = {
      to: [],
      subject: "",
      body: ""
    };
  }

  public render(): React.ReactElement<IMailFormProps> {
    return (
      <div className={styles.mailform}>
        <div className={styles.container}>
          <PeoplePicker
            context={this.props.context}
            titleText="å®›å…ˆ"
            personSelectionLimit={99}
            principalTypes={[PrincipalType.User]}
            selectedItems={value => this.setState({ to: value })} />
          <TextField
            label="ä»¶å"
            value={this.state.subject}
            onChanged={value => this.setState({ subject: value })} />
          <TextField
            label="æœ¬æ–‡"
            multiline
            rows={10}
            onChanged={value => this.setState({ body: value })} />
          <div className={styles.buttons}>
          <PrimaryButton
              text="é€ä¿¡"
              onClick={this._onSendButtonClick.bind(this)} />
          </div>
        </div>
      </div>
    );
  }

  private _onSendButtonClick(): void {
    this.props.context.msGraphClientFactory
      .getClient()
      .then((client: MSGraphClient) => {
        client.api('/me/sendMail').post(
          {
            message: {
              toRecipients: this.state.to.map(value => { return { emailAddress: { address: value.secondaryText } }; }),
              subject: this.state.subject,
              body: {
                content: this.state.body,
                contentType: 'text'
              }
            }
          },
          (error: any, response: any, rawResponse: any) => {
            if (error) {
              window.alert("ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            } else {
              window.alert("ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚");
            }
          });
      });
  }

}
```

# å®Ÿè¡Œçµæœ

å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚ãƒ¢ãƒ€ãƒ³ UI ã¨èª¿å’Œæ€§ã®å–ã‚ŒãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

![](/images/2020_02_09_170000_001.png)

Office UI Fablic ã¨ PnP SPFx Controls ã®æ©æµã‚’å—ã‘ã‚‰ã‚Œã‚‹ã®ã¯éå¸¸ã«å¤§ãã„ã®ã§ã€ãœã² React ã‚’ä½¿ã£ã¦ SPFx é–‹ç™ºã‚’æ¥½ã—ã‚“ã§ã„ãŸã ã‘ãŸã‚‰ã¨æ€ã„ã¾ã™ã€‚
