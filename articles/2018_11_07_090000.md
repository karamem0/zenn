---
title: "Power BI でマトリックスを使わないでマトリックスを頑張ってみる"
emoji: "💻"
type: "tech"
topics: ["powerbi"]
published: true
---

:::message
この記事ははてなブログに 2018/11/7 に投稿したものの転載です。
:::

# はじめに

Power BI を使ってザ・ジャパニーズな帳票を実現するためのバッドノウハウです。

# 問題点

例として東京の平均気温をマトリックスにしてみます。行に年月、列に平均気温を 5 ℃刻みで指定します。

![](/images/2018_11_07_090000_001.png)

はい、できました。しかし問題があります。**5 ℃未満** の列が左端にきてほしいのですが右端にきてしまっています。Power BI のマトリックスでは列の順序は昇順または降順でしか並べ替えるしかできないため、辞書順に並べ替えた結果、このような順序になってしまいます。

次に特定の年月でフィルターしてみます。

![](/images/2018_11_07_090000_002.png)

今後は **5 ℃未満** の列が表示されません。データのない列は表示されません。しかし列ヘッダーは固定でほしいという要望もあるでしょう。

# 解決方法

Power Query で頑張ります。

クエリの参照を作り、行列 (年月、分類) でグループ化します。列ヘッダーの中身に合うようにフィルターします。これを列の数だけ作成します。

![](/images/2018_11_07_090000_003.png)

もうひとつクエリの参照を作ります。行 (年月) でグループ化して、先ほど作った列のクエリをひたすらマージします。列の順番も任意に並べ替えられます。

![](/images/2018_11_07_090000_004.png)

マトリックスではなくテーブルでデータを表示します。**5 ℃未満** の列が左端にきています。

![](/images/2018_11_07_090000_005.png)

フィルターをかけてもいい感じです。

![](/images/2018_11_07_090000_006.png)

# おわりに

あくまで「頑張ればできるよ」という感じ。Excel のピボット テーブルだともうちょっといろいろできるので、そっちでやったほうがいいと思います。
