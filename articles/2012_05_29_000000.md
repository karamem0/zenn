---
title: "knockout.js ã‚’ä½¿ã£ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["csharp", "javascript"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2012/5/29 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

knockout.js ãŒã„ã„æ„Ÿã˜ã«ä¾¿åˆ©ã§æ¥½ã—ã„ã®ã§ã€ã„ã‚ã„ã‚è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã¯ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

# ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°

## Shared/_Layout.cshtml

knockout.js ã‚’å‘¼ã‚“ã§ãŠãã®ã‚’å¿˜ã‚Œãšã«ã€‚knockout.js ã¯ NuGet ã§å…¥æ‰‹ã§ãã¾ã™ã€‚

```html
<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>
    <script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout-2.1.0.js")" type="text/javascript"></script>
</head>
<body>
    <div>
        @RenderBody()
    </div>
</body>
</html>
```

## Home/Index.cshtml

ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã® ViewModel ã‚’ä½œæˆã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚µãƒ¼ãƒãƒ¼ã«æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ (`pageIndex`ã€`pageSize`) ã‚„ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å—ã‘å–ã‚‹ãƒ‡ãƒ¼ã‚¿ (`totalCount`ã€`totalPage`ã€`items`) ã‚’ä¿æŒã—ã¾ã™ã€‚ã“ã® ViewModel ã«ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚’è¡Œã†ãŸã‚ã® `movePrevious`ã€`moveNext`ã€`moveTo` ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¨ã®ã‚„ã‚Šå–ã‚Šã¯ `load` ãƒ¡ã‚½ãƒƒãƒ‰ã§è¡Œã„ã¾ã™ã€‚
HTML ã§ã¯ knockout.js ã®ä½œæ³•ã«å¾“ã£ã¦ `data-bind` å±æ€§ã‚’è¨˜è¿°ã—ã¦ã„ãã¾ã™ã€‚`click` ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ `data-bind` ã«æ›¸ã‘ã¦ã—ã¾ã†ã®ãŒå¬‰ã—ã„ã¨ã“ã‚ã§ã™ã€‚ä»Šå›ã¯å®Ÿè£…ã—ã¦ã„ã¾ã›ã‚“ãŒã€å…ˆé ­ã‚„æœ€å¾Œã®ãƒšãƒ¼ã‚¸ã®ã¨ãã«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã® **å‰ã¸** ã‚„ **æ¬¡ã¸** ã‚’ç„¡åŠ¹åŒ–ã—ãŸã„å ´åˆã¯ã€`data-bind="if:"` ã‚„ `data-bind="notif:"` ã‚’ä½¿ã†ã®ãŒä¾¿åˆ©ã§ã™ã€‚

```html
@{
    ViewBag.Title = "ãƒ›ãƒ¼ãƒ ";
}
<div>
    <div>
        <a href="javascript:void(0)" data-bind="click: movePrevious">å‰ã¸</a>
        <a href="javascript:void(0)" data-bind="click: moveNext">æ¬¡ã¸</a>
    </div>
    <hr />
    <div data-bind="foreach: items">
        <div>åå‰: <span data-bind="text: Name"></span></div>
        <div>èª•ç”Ÿæ—¥: <span data-bind="text: Birthday"></span></div>
        <div>å›½ç±: <span data-bind="text: Nationality"></span></div>
        <hr />
    </div>
</div>
<script type="text/javascript">
    $(function () {
        var viewModel = {
            // ã‚µãƒ¼ãƒãƒ¼ã®URL
            url: "@Url.Content("~/Home/Index")",
            // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ç•ªå·
            pageIndex: ko.observable(1),
            // ãƒšãƒ¼ã‚¸ã«è¡¨ç¤ºã™ã‚‹ä»¶æ•°
            pageSize: ko.observable(3),
            // ç·ä»¶æ•°
            totalCount: ko.observable(0),
            // ç·ãƒšãƒ¼ã‚¸æ•°
            totalPage: ko.observable(0),
            // çµæœã®ãƒªã‚¹ãƒˆ
            items: ko.observableArray([]),
            // å‰ã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
            movePrevious: function () {
                if (this.pageIndex() > 1) {
                    this.moveTo(this.pageIndex() - 1);
                }
            },
            // æ¬¡ã®ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
            moveNext: function () {
                if (this.pageIndex() < this.totalPage()) {
                    this.moveTo(this.pageIndex() + 1);
                }
            },
            // æŒ‡å®šã—ãŸãƒšãƒ¼ã‚¸ã«ç§»å‹•ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
            moveTo: function (index) {
                this.pageIndex(index);
                this.load();
            },
            // ã‚µãƒ¼ãƒãƒ¼ã«å•ã„åˆã‚ã›ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
            load: function () {
                // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã¯ã‚µãƒ¼ãƒãƒ¼ã§ã¯ FormCollection ã§å—ã‘å–ã‚‹
                var param = {
                    pageIndex: this.pageIndex,
                    pageSize: this.pageSize
                };
                // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
                var callback = function (data) {
                    viewModel.totalCount(data.TotalCount);
                    viewModel.totalPage(data.TotalPage);
                    viewModel.items.removeAll();
                    $.each(data.Items, function (i, e) { viewModel.items.push(e) });
                };
                // POST ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹
                $.post(this.url, param, callback, "json");
            }
        };
        ko.applyBindings(viewModel);
        viewModel.load();
    })
</script>
```

## HomeController.cs

Controller ã§ã¯ `Skip` ã¨ `Take` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ã¾ã™ã€‚

```csharp
public class HomeController : Controller
{

    public ActionResult Index()
    {
        return View();
    }

    [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Index(FormCollection collection)
    {
        var data = new[]
        {
            new { Name = "è—æ¾¤å„ª", Birthday = "4/30", Nationality = "å°æ¹¾" },
            new { Name = "è—æ¾¤è‘µ", Birthday = "11/12", Nationality = "å°æ¹¾" },
            new { Name = "è—æ¾¤ç²", Birthday = "7/10", Nationality = "å°æ¹¾" },
            new { Name = "è—æ¾¤å…‰", Birthday = "9/27", Nationality = "å°æ¹¾" },
            new { Name = "çª“è¾ºãªãªã¿", Birthday = "4/6", Nationality = "æ—¥æœ¬" },
            new { Name = "ã‚¯ãƒ©ã‚¦ãƒ‡ã‚£ã‚¢çª“è¾º", Birthday = "11/20", Nationality = "ã‚¢ãƒ¡ãƒªã‚«" },
            new { Name = "ã‚¯ãƒ­ãƒ¼ãƒ‰çª“è¾º", Birthday = "4/4", Nationality = "ã‚¢ãƒ¡ãƒªã‚«" },
            new { Name = "ã‚¦ã‚§ãƒ–ãƒãƒˆãƒªã‚¯ã‚¹ãƒãƒ³", Birthday = "ä¸æ˜", Nationality = "æ—¥æœ¬" }
        };
        var pageIndex = int.Parse(collection["pageIndex"]);
        var pageSize = int.Parse(collection["pageSize"]);
        return Json(new
        {
            TotalCount = data.Count(),
            TotalPage = (int)Math.Ceiling((double)data.Count() / pageSize),
            Items = data.Skip(pageSize * (pageIndex - 1)).Take(pageSize)
        });
    }

}
```

# å®Ÿè¡Œçµæœ

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](/images/2012_05_29_000000_001.png)

**æ¬¡ã¸** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã‚‹ã¨ãƒšãƒ¼ã‚¸ãŒåˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

![](/images/2012_05_29_000000_002.png)

# ãŠã‚ã‚Šã«

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒè²§å¼±ã§ã™ãŒã€é ‘å¼µã‚Œã°ãƒšãƒ¼ã‚¸ç•ªå·ã«ãƒªãƒ³ã‚¯ã‚’ã¤ã‘ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚å‰²ã¨ã‚ˆãä½¿ã†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã ã¨æ€ã‚ã‚Œã‚‹ã®ã§ã€ViewModel ã‚’ã‚¯ãƒ©ã‚¹åŒ–ã—ã¦ã—ã¾ãˆã°ã€ã‹ãªã‚Šä¾¿åˆ©ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚
