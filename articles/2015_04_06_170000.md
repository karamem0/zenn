---
title: "PowerShell ã§ iPhone ã®ç”»åƒã®å›è»¢ã‚’å…ƒã«æˆ»ã™"
emoji: "ğŸ’»"
type: "tech"
topics: ["powershell"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2015/4/6 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

iPhone ã§æ’®å½±ã—ãŸå†™çœŸã¯ç¸¦æ¨ªãŒé€†ã«ãªã£ã¦ã—ã¾ã†ã“ã¨ãŒã‚ã‚‹ã‚‰ã—ãã€æ¤œç´¢ã™ã‚Œã°æƒ…å ±ã¯ã„ã£ã±ã„å‡ºã¦ãã‚‹ã®ã§ã™ãŒã€è¦ã™ã‚‹ã« Exif æƒ…å ±ã‚’èªè­˜ã—ã¦å›è»¢ã—ã¦ãã‚Œãªã„ã“ã¨ãŒåŸå› ã®ã‚ˆã†ã§ã™ã€‚ç…©ã‚ã—ã„ã®ã§ Exif ã«å¾“ã£ã¦ç”»åƒã”ã¨å›è»¢ã—ã¦ã—ã¾ã„ãŸã„ã¨æ€ã„ã¾ã™ã€‚C# ã§ã¯æƒ…å ±ãŒè¦‹ã¤ã‹ã£ãŸã‚‚ã®ã®ã€C# ã§æ›¸ãã»ã©ã§ã‚‚ãªã„ã®ã§ã€PowerShell ã§æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚ã“ã‚Œã‚’ `ps1` ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦å®Ÿè¡Œã™ã‚Œã°è§£æ±ºï¼æ¥½ã¡ã‚“ï¼

https://smdn.jp/programming/netfx/tips/rotate_image_by_exif_info

```powershell
[void][System.Reflection.Assembly]::LoadWithPartialName("System.Drawing")
[void][System.Reflection.Assembly]::LoadWithPartialName("System.IO")

$sourceDir = "{{source-folder}}"
$destDir = "{{dest-folder}}"

foreach ($sourceFile in [System.IO.Directory]::GetFiles($sourceDir, "*")) {

    $destFile = [System.IO.Path]::Combine($destDir, [System.IO.Path]::GetFileName($sourceFile))

    $origin = New-Object System.Drawing.Bitmap($sourceFile)
    $rotation = [System.Drawing.RotateFlipType]::RotateNoneFlipNone

    foreach ($item in $origin.PropertyItems) {
        if ($item.Id -eq 274) {
            if ($item.Value[0] -eq 3) {
                $rotation = [System.Drawing.RotateFlipType]::Rotate180FlipNone
            }
            if ($item.Value[0] -eq 6) {
                $rotation = [System.Drawing.RotateFlipType]::Rotate90FlipNone
            }
            if ($item.Value[0] -eq 8) {
                $rotation = [System.Drawing.RotateFlipType]::Rotate270FlipNone
            }
        }
    }

    $rotated = [System.Drawing.Bitmap]$origin.Clone()
    $rotated.RotateFlip($rotation)
    foreach ($item in $origin.PropertyItems) {
        if ($item.Id -eq 274) {
            $item.Value[0] = 0
            $rotated.SetPropertyItem($item)
        }
    }

    $rotated.Save($destFile, [System.Drawing.Imaging.ImageFormat]::Jpeg)

    $origin.Dispose()
    $rotated.Dispose()

}
```
