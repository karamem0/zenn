---
title: "knockout.js ã§ãƒšãƒ¼ã‚¸ã®å†èª­ã¿è¾¼ã¿ã«å¯¾å¿œã™ã‚‹"
emoji: "ğŸ’»"
type: "tech"
topics: ["csharp", "javascript"]
published: true
---

:::message
ã“ã®è¨˜äº‹ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã« 2012/7/19 ã«æŠ•ç¨¿ã—ãŸã‚‚ã®ã®è»¢è¼‰ã§ã™ã€‚
:::

# ã¯ã˜ã‚ã«

å‰å›ã®è¨˜äº‹ã®ç¶šãã§ã™ã€‚

https://zenn.dev/karamem0/articles/2012_07_19_000000

å‰å›ã®çŠ¶æ…‹ã ã¨ã€ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã™ã‚‹ã¨ã€æ¤œç´¢çµæœãŒã™ã¹ã¦æ¶ˆãˆã¦åˆæœŸçŠ¶æ…‹ã«æˆ»ã£ã¦ã—ã¾ã†ã¨ã„ã†å•é¡Œç‚¹ãŒã‚ã‚Šã¾ã—ãŸã€‚ãã‚Œã§ã¯ã‚„ã¯ã‚Šä½¿ã„å‹æ‰‹ãŒæ‚ªã„ã®ã§ã€å¯¾å¿œã‚’è€ƒãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ç°¡å˜ã«è¨€ã£ã¦ã—ã¾ã†ã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã©ã“ã‹ã«ä¿å­˜ã—ã¦ãŠã‘ã°ã„ã„ã®ã§ã™ãŒã€ã¨ã‚Šã‚ãˆãšã‚µãƒ¼ãƒãƒ¼å´ã«ä¿å­˜ã—ã¦ã¿ã¾ã™ã€‚

# ã‚³ãƒ¼ãƒ‰ã®è¨˜è¿°

## Controllers/HomeController.cs

å‰å›ã‹ã‚‰ã®å¤‰æ›´ç‚¹ã¨ã—ã¦ã€æ¤œç´¢ã•ã‚ŒãŸã¨ãã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«å…¥ã‚Œã¦ã„ã‚‹ã®ã¨ã€åˆæœŸè¡¨ç¤ºã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã° `ViewBag` ã«å…¥ã‚Œã‚‹ã¨ã“ã‚ãŒè¿½åŠ ã•ã‚Œã¦ã„ã¾ã™ã€‚

```csharp
public class HomeController : Controller
{

    public ActionResult Index()
    {
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã° ViewBag ã«å…¥ã‚Œã‚‹
        var person = this.Session["Person"] as Person;
        if (person != null)
        {
            this.ViewBag.Person = person;
        }
        return View();
    }

    [HttpPost()]
    public JsonResult Index(Person person)
    {
        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«æ ¼ç´ã™ã‚‹
        this.Session["Person"] = person;

        var data = new[]
        {
            new Person() { Id = "1", Name = "ä½è—¤å¤ªéƒ", Age = 30, },
            new Person() { Id = "2", Name = "å±±ç”°æ¬¡éƒ", Age = 15, },
            new Person() { Id = "3", Name = "é«˜æ©‹ä¸‰éƒ", Age = 60, },
            new Person() { Id = "4", Name = "ç”°ä¸­å››éƒ", Age = 55, },
            new Person() { Id = "5", Name = "éˆ´æœ¨äº”éƒ", Age = 45, },
        };
        return this.Json(
            data.Where(x => string.IsNullOrEmpty(person.Id) || x.Id == person.Id)
                .Where(x => string.IsNullOrEmpty(person.Name) || x.Name.Contains(person.Name))
                .Where(x => person.Age == null || x.Age == person.Age)
        );
    }
}
```

## Views/Home/Index.cshtml

`ViewBag` ã«å…¥ã‚Œã‚‰ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ `Json.Encode` ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ã§ JavaScript ã‹ã‚‰èª­ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã‚ã¨ã¯ãã‚Œã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«çªã£è¾¼ã‚“ã§å†æ¤œç´¢ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

```html
<script type="text/javascript">
    $(function () {
        var viewModel = {
            items: ko.observableArray([]),
            search: function () {
                var self = this;
                var param = {};
                $("form :input").each(function () {
                    var name = $(this).attr("name");
                    var val = $(this).val();
                    param[name] = val;
                });
                var callback = function (data) {
                    self.items.removeAll();
                    $.each(data, function (i, e) {
                        self.items.push(e);
                    });
                };
                $.post("@Url.Action("Index")", param, callback, "json");
            }
        };
        ko.applyBindings(viewModel);

        // ViewBag ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚‚ã‚‰ã†
        var person = @Html.Raw(Json.Encode(ViewBag.Person));
        if (person != null) {
            // ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹
            $("form :input").each(function () {
                var name = $(this).attr("name");
                var val = person[name];
                if (val != null) {
                    $(this).val(val);
                }
            });
            // å†æ¤œç´¢
            viewModel.search();
        }
    });
</script>
```

# ãŠã‚ã‚Šã«

ã“ã‚Œã§å†èª­ã¿è¾¼ã¿ã‚’ã—ã¦ã‚‚å…ƒã®çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
